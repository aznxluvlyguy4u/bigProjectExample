# Learn more about services, parameters and containers at
# http://symfony.com/doc/current/book/service_container.html
parameters:
#    parameter_name: value

services:

    api.entity.validate:
        class: AppBundle\Service\ValidateEntityService
        arguments: ['@validator', '@jms_serializer']

    api.action_log:
        class: AppBundle\Service\ActionLogService
        arguments:
          - '@doctrine.orm.entity_manager'
          - '@app.serializer.ir'
          - '@app.user'
          - '@app.cache'

    app.cli.gender_changer:
        class: AppBundle\Service\DataFix\GenderChangeCommandService
        arguments:
          - '@doctrine.orm.entity_manager'

    app.cli.internal_worker.depart:
        class: AppBundle\Service\Worker\DepartInternalWorkerCliOptions
        arguments:
          - '@doctrine.orm.entity_manager'

    AppBundle\Cache\BreedValuesResultTableUpdater:
        arguments:
          - '@doctrine.orm.default_entity_manager'
          - '@logger'
          - '@AppBundle\Service\BreedValueService'
          - '@AppBundle\Service\BreedIndexService'
          - '@AppBundle\Service\NormalDistributionService'

    app.info.parameters:
        class: AppBundle\Service\InfoService
        arguments:
          - '@doctrine.orm.entity_manager'
          - '@logger'
          - '@app.aws.storageservice'
          - '%kernel.environment%'
          - '%environment%'
          - '%kernel.root_dir%'
          - '%kernel.cache_dir%'
          - '%redis_host%'
          - '@AppBundle\Service\AwsExternalQueueService'
          - '@AppBundle\Service\AwsInternalQueueService'
          - '@AppBundle\Service\MixBlupInputQueueService'
          - '@AppBundle\Service\MixBlupOutputQueueService'


    app.request.message_builder:
        class: AppBundle\Component\RequestMessageBuilder
        arguments:
          - '@doctrine.orm.entity_manager'
          - '@app.serializer.ir'
          - '%kernel.environment%'


    app.aws.queueservice.workers_base:
        abstract: true
        arguments:
        #NOTE! Don't use named keys here! That will prevent the child services from properly overriding the arguments.
          - placeholder_to_override #queueIdPrefix
          - '%aws_access_key_id%'
          - '%aws_secret_key%'
          - '%aws_sqs_region%' #region
          - '%aws_sqs_version%' #version
          - '%environment%' #currentEnv
          - '%kernel.environment%'
          - true

    AppBundle\Service\AwsFeedbackQueueService:
        parent: app.aws.queueservice.workers_base
        arguments: { index_0: '%aws_sqs_queue_feedback_prefix%' }

    AppBundle\Service\AwsExternalQueueService:
        parent: app.aws.queueservice.workers_base
        arguments: { index_0: '%aws_sqs_queue_exteral_prefix%' }

    AppBundle\Service\AwsExternalTestQueueService:
        parent: app.aws.queueservice.workers_base
        arguments: { index_0: '%aws_sqs_queue_exteral_prefix%', index_5: !php/const:AppBundle\Constant\Environment::TEST, index_7: false }

    AppBundle\Service\AwsInternalQueueService:
        parent: app.aws.queueservice.workers_base
        arguments: { index_0: '%aws_sqs_queue_interal_prefix%' }

    AppBundle\Service\AwsInternalTestQueueService:
        parent: app.aws.queueservice.workers_base
        arguments: { index_0: '%aws_sqs_queue_interal_prefix%', index_5: !php/const:AppBundle\Constant\Environment::TEST, index_7: false }

    AppBundle\Service\MixBlupInputQueueService:
        parent: app.aws.queueservice.workers_base
        arguments: { index_0: '%aws_sqs_queue_mixblup_input_prefix%', index_7: false }

    AppBundle\Service\MixBlupOutputQueueService:
        parent: app.aws.queueservice.workers_base
        arguments: { index_0: '%aws_sqs_queue_mixblup_output_prefix%', index_7: false }

    app.aws.storageservice:
        class: AppBundle\Service\AWSSimpleStorageService
        arguments:
          - '%aws_access_key_id%'
          - '%aws_secret_key%'
          - '%aws_s3_region%'
          - '%aws_s3_version%'
          - '%aws_s3_bucket%'
          - '%environment%'
          - '%kernel.environment%'

    app.mollie.service:
        class: AppBundle\Service\MollieService
        arguments:
          $credentials: ['%mollie_test_api_key%', '%mollie_prod_api_key%']
          $apiUrls: ['%api_local_host_url%','%api_stage_host_url%','%api_prod_host_url%']
          $webUrls: ['%web_local_host_url%','%web_stage_host_url%','%web_prod_host_url%']
          $currentEnvironment: '%environment%'

    app.doctrine.entitygetter:
        class: AppBundle\Service\EntityGetter
        arguments: ['@doctrine.orm.entity_manager']

    app.modifier.message:
        class: AppBundle\Component\Modifier\MessageModifier
        arguments: ['@doctrine.orm.entity_manager']

    app.modifier.animalremover:
        class: AppBundle\Component\Modifier\AnimalRemover
        arguments: ['@doctrine.orm.entity_manager']

    app.animal.details.updater:
        parent: app.abstract_base.controller
        class: AppBundle\Service\AnimalDetailsUpdaterService
        calls:
          - method: setAnimalDetailsBatchUpdater
            arguments:
              - '@AppBundle\Service\AnimalDetailsBatchUpdaterService'
          - method: setAnimalDetailsOutput
            arguments:
              - '@AppBundle\Output\AnimalDetailsOutput'

    AppBundle\Service\AnimalDetailsBatchUpdaterService:
        parent: app.abstract_base.controller

    app.animallocation.history:
        class: AppBundle\Service\AnimalLocationHistoryService
        arguments: ['@doctrine.orm.entity_manager']

    app.messagebuilder.base:
        class: AppBundle\Component\MessageBuilderBase
        arguments:
          - '@doctrine.orm.entity_manager'
          - '%environment%'

    AppBundle\Service\MixBlupInputFilesService:
        arguments:
          - '@doctrine.orm.entity_manager'
          - '@app.aws.storageservice'
          - '@AppBundle\Service\MixBlupInputQueueService'
          - '%environment%'
          - '%kernel.cache_dir%'
          - '@logger'

    AppBundle\Service\MixBlupOutputFilesService:
        arguments:
          - '@doctrine.orm.entity_manager'
          - '@app.aws.storageservice'
          - '@AppBundle\Service\MixBlupOutputQueueService'
          - '@AppBundle\Service\BreedIndexService'
          - '@AppBundle\Service\BreedValueService'
          - '@AppBundle\Cache\BreedValuesResultTableUpdater'
          - '@AppBundle\Service\NormalDistributionService'
          - '%environment%'
          - '%kernel.cache_dir%'
          - '@logger'

    AppBundle\Component\MixBlup\MixBlupInputFileValidator:
        arguments: ['%kernel.cache_dir%']


    AppBundle\Service\NormalDistributionService:
        arguments:
          - '@doctrine.orm.entity_manager'
          - '@logger'
        calls:
          - method: onInit

    app.datafix.base.duplicate:
        abstract: true
        arguments:
        #NOTE! Don't use named keys here! That will prevent the child services from properly overriding the arguments.
          - '@doctrine.orm.entity_manager'

    app.datafix.animals.duplicate:
        parent: app.datafix.base.duplicate
        class: AppBundle\Service\DataFix\DuplicateAnimalsFixer

    app.datafix.litter.duplicate:
        parent: app.datafix.base.duplicate
        class: AppBundle\Service\DataFix\DuplicateLitterFixer

    app.datafix.animals.exterminator:
        parent: app.datafix.base.duplicate
        class: AppBundle\Service\DataFix\AnimalExterminator

    app.datafix.ubn:
        parent: app.datafix.base.duplicate
        class: AppBundle\Service\DataFix\UbnFixer

    app.datafix.base:
        abstract: true
        arguments:
        #NOTE! Don't use named keys here! That will prevent the child services from properly overriding the arguments.
          - '@doctrine.orm.entity_manager'
          - '@logger'
          - '%kernel.root_dir%'

    app.datafix.breed_code.offspring.recalculation:
        parent: app.datafix.base
        class: AppBundle\Service\DataFix\OffspringBreedCodeRecalculator

    app.datafix.birth.measurements.missing:
        parent: app.datafix.base
        class: AppBundle\Service\DataFix\MissingBirthMeasurementsService

    AppBundle\Service\DataFix\MissingUbnOfBirthFillerService:
        parent: app.datafix.base

    app.migrator.vsm:
        class: AppBundle\Service\Migration\VsmMigratorService
        arguments:
          - '@doctrine.orm.entity_manager'
          - '%kernel.root_dir%'
          - '@app.migrator.importer.animaltable'
          - '@app.migrator.animaltable'
          - '@app.migrator.birth'
          - '@app.migrator.date_of_death'
          - '@app.migrator.exteriors'
          - '@app.migrator.litters'
          - '@app.migrator.tagreplace'
          - '@app.migrator.wormresistance'
          - '@app.datafix.animals.duplicate'
          - '@app.datafix.litter.duplicate'

    app.migrator.base:
        abstract: true
        arguments:
        #NOTE! Don't use named keys here! That will prevent the child services from properly overriding the arguments.
          - '@doctrine.orm.entity_manager'
          - '%kernel.root_dir%'

    app.migrator.importer.animaltable:
        class: AppBundle\Service\Migration\AnimalTableImporter
        arguments:
          - '@doctrine.orm.entity_manager'
          - '%kernel.root_dir%'
          - '@app.datafix.animals.duplicate'
          - '@app.datafix.ubn'

    app.migrator.animaltable:
        class: AppBundle\Service\Migration\AnimalTableMigrator
        arguments:
          - '@doctrine.orm.entity_manager'
          - '%kernel.root_dir%'
          - '@app.datafix.ubn'

    app.migrator.birth:
        parent: app.migrator.base
        class: AppBundle\Service\Migration\BirthDataMigrator

    app.initializer.birth_progress:
        parent: app.migrator.base
        class: AppBundle\Service\Migration\BirthProgressInitializer

    AppBundle\Service\Migration\PedigreeRegisterRegistrationMigrator:
        parent: app.migrator.base

    app.initializer.treatment_type:
        parent: app.migrator.base
        class: AppBundle\Service\Migration\TreatmentTypeInitializer

    app.database.content.initializer:
        abstract: true
        arguments:
          - '@doctrine.orm.entity_manager'
          - '@logger'
          - '@translator'

    AppBundle\Service\Migration\StoredProcedureInitializer:
        parent: app.database.content.initializer

    AppBundle\Service\Migration\SqlViewInitializer:
        parent: app.database.content.initializer

    app.migrator.client:
        class: AppBundle\Service\Migration\ClientMigrator
        arguments:
          - '@doctrine.orm.entity_manager'
          - '%kernel.root_dir%'
          - '@security.password_encoder'

    app.migrator.date_of_death:
        parent: app.migrator.base
        class: AppBundle\Service\Migration\DateOfDeathMigrator

    app.migrator.exteriors:
        parent: app.migrator.base
        class: AppBundle\Service\Migration\ExteriorMigrator

    AppBundle\Service\Migration\ScanMeasurementsMigrator:
        parent: app.migrator.base

    app.migrator.inspector:
        parent: app.migrator.base
        class: AppBundle\Service\Migration\InspectorMigrator

    app.migrator.breed_index_base:
        abstract: true
        arguments:
        #NOTE! Don't use named keys here! That will prevent the child services from properly overriding the arguments.
          - '@doctrine.orm.entity_manager'
          - '@logger'

    AppBundle\Service\Migration\LedgerCategoryMigrator:
        parent: app.migrator.base

    AppBundle\Service\Migration\PedigreeCodeInitializer:
        parent: app.migrator.base

    AppBundle\Service\Invoice\BatchInvoiceRuleInitializer:
        parent: app.migrator.base

    AppBundle\Service\Migration\MixBlupAnalysisTypeMigrator:
        parent: app.migrator.base

    AppBundle\Service\Migration\LambMeatIndexMigrator:
        parent: app.migrator.breed_index_base

    AppBundle\Service\Migration\WormResistanceIndexMigrator:
        parent: app.migrator.breed_index_base

    app.migrator.litters:
        parent: app.migrator.base
        class: AppBundle\Service\Migration\LitterMigrator

    app.migrator.tagreplace:
        parent: app.migrator.base
        class: AppBundle\Service\Migration\TagReplaceMigrator

    app.migrator.wormresistance:
        parent: app.migrator.base
        class: AppBundle\Service\Migration\WormResistanceMigrator

    AppBundle\Service\BreedIndexService:
        arguments:
          - '@doctrine.orm.entity_manager'
          - '@logger'

    AppBundle\Service\BreedValueService:
        arguments:
          - '@doctrine.orm.entity_manager'
          - '@logger'

    AppBundle\Service\BreedValuePrinter:
        arguments:
          - '@doctrine.orm.entity_manager'
          - '@logger'
          - '%kernel.cache_dir%'

    AppBundle\Service\ExcelService:
        arguments:
          - '@phpexcel'
          - '%kernel.cache_dir%'
          - '@logger'

    app.serializer.base:
        class: AppBundle\Service\BaseSerializer
        arguments: ['@jms_serializer']

    app.serializer.ir:
        class: AppBundle\Service\IRSerializer
        arguments: ['@jms_serializer', '@doctrine.orm.entity_manager', '@app.doctrine.entitygetter', '@AppBundle\Service\PedigreeDataGenerator']

    app.health.updater:
        class: AppBundle\Service\HealthUpdaterService
        arguments:
          - '@doctrine.orm.entity_manager'
          - '@app.health.locationhealth.updater'

    app.health.locationhealth.updater:
        class: AppBundle\Util\LocationHealthUpdater
        arguments:
          - '@doctrine.orm.entity_manager'
          - '@app.email'
          - '@logger'

    app.authenticator.token:
        class: AppBundle\Component\Authentication\TokenAuthenticator
        arguments:
          - '@doctrine.orm.entity_manager'
          - '@security.http_utils'
          - ['/api/v1/doc', '/api/v1/auth/register', '/api/v1/auth/authorize']
        public: false

    app.cache:
        class: AppBundle\Service\CacheService
        arguments:
          - '%redis_host%'

    app.user:
        class: AppBundle\Service\UserService
        arguments:
          - '@doctrine.orm.entity_manager'
          - '@security.token_storage'

    app.report.generator.query.breed_values:
        class: AppBundle\Service\Report\BreedValuesReportQueryGenerator
        arguments:
          - '@doctrine.orm.entity_manager'
          - '@translator'

    app.report.base:
        abstract: true
        lazy: true
        arguments:
        #NOTE! Don't use named keys here! That will prevent the child services from properly overriding the arguments.
          - '@doctrine.orm.entity_manager'
          - '@AppBundle\Service\ExcelService'
          - '@logger'
          - '@app.aws.storageservice'
          - '@app.writer.csv_from_sql_results'
          - '@app.user'
          - '@templating'
          - '@translator'
          - '@knp_snappy.pdf'
          - '@AppBundle\Validation\UlnValidatorInterface'
          - '%kernel.cache_dir%'
          - '%kernel.root_dir%'
          - '%output_reports_to_cache_folder_for_local_testing%'
          - '%display_report_pdf_output_as_html%'

    app.report.breedvalues.base:
        abstract: true
        arguments:
        #NOTE! Don't use named keys here! That will prevent the child services from properly overriding the arguments.
          - '@doctrine.orm.entity_manager'
          - '@AppBundle\Service\ExcelService'
          - '@logger'
          - '@app.aws.storageservice'
          - '@app.writer.csv_from_sql_results'
          - '@app.user'
          - '@templating'
          - '@translator'
          - '@knp_snappy.pdf'
          - '@AppBundle\Validation\UlnValidatorInterface'
          - '@app.report.generator.query.breed_values'
          - '%kernel.cache_dir%'
          - '%kernel.root_dir%'
          - '%output_reports_to_cache_folder_for_local_testing%'
          - '%display_report_pdf_output_as_html%'

    app.report.livestock:
        parent: app.report.breedvalues.base
        class: AppBundle\Service\Report\LiveStockReportService

    AppBundle\Service\Report\AnimalsOverviewReportService:
        parent: app.report.breedvalues.base
        lazy: true

    AppBundle\Service\Report\AnnualActiveLivestockReportService:
        lazy: true
        parent: app.report.base

    AppBundle\Service\Report\AnnualActiveLivestockRamMatesReportService:
        parent: app.report.base

    AppBundle\Service\Report\AnnualTe100UbnProductionReportService:
        parent: app.report.breedvalues.base

    AppBundle\Service\Report\OffspringReportService:
        parent: app.report.breedvalues.base

    app.report.pedigree_certificates:
        parent: app.report.base
        class: AppBundle\Service\Report\PedigreeCertificateReportService
        lazy: true
        calls:
          - method: setPedigreeCertificatesGenerator
            arguments:
              - '@AppBundle\Report\PedigreeCertificates'

    AppBundle\Service\Report\PedigreeRegisterOverviewReportService:
        parent: app.report.base

    AppBundle\Service\Report\BreedValuesOverviewReportService:
        parent: app.report.breedvalues.base

    app.report.inbreeding_coefficient:
        parent: app.report.base
        class: AppBundle\Service\Report\InbreedingCoefficientReportService
        lazy: true

    AppBundle\Service\Report\FertilizerAccountingReport:
        parent: app.report.base

    AppBundle\Service\Report\BirthListReportService:
      parent: app.report.base

    app.report.vwa.animal_details:
        parent: app.report.base
        class: AppBundle\Service\Report\VwaAnimalDetailsReportService

    app.report.vwa.ubns_overview:
        parent: app.report.base
        class: AppBundle\Service\Report\VwaUbnsOverviewReportService

    AppBundle\Report\PedigreeCertificate:
        arguments:
            - '@doctrine.orm.entity_manager'
            - '@translator'
            - '%use_test_data%'
            - '%environment%'
        calls:
          - method: setBreedValuesOutput
            arguments:
              - '@AppBundle\Output\BreedValuesOutput'
        lazy: true

    AppBundle\Report\PedigreeCertificates:
        arguments:
            - '@doctrine.orm.entity_manager'
            - '@AppBundle\Report\PedigreeCertificate'
        calls:
          - method: initializeConstants
          - method: setBreedValuesOutput
            arguments:
              - '@AppBundle\Output\BreedValuesOutput'
        lazy: true

    app.writer.csv_from_sql_results:
        class: AppBundle\Service\CsvFromSqlResultsWriterService
        arguments:
            - '@doctrine.orm.entity_manager'
            - '@logger'
            - '@translator'
            - '%kernel.cache_dir%'


    app.declare.error_message:
        parent: app.abstract_base.controller
        class: AppBundle\Service\ErrorMessageService

    AppBundle\Service\LedgerCategoryService:
        parent: app.abstract_base.controller

    app.treatment.base:
        parent: app.abstract_base.controller
        abstract: true
        calls:
          - method: onInit

    app.treatment:
        parent: app.treatment.base
        class: AppBundle\Service\TreatmentService

    app.treatment.template:
        parent: app.treatment.base
        class: AppBundle\Service\TreatmentTemplateService

    app.treatment.type:
        parent: app.treatment.base
        class: AppBundle\Service\TreatmentTypeService

    app.email:
        class: AppBundle\Service\EmailService
        arguments:
          - '@mailer'
          - '%mailer_source_address%'
          - '%notification_email_addresses%'
          - '@templating'
          - '@translator'
          - '@logger'
          - '%kernel.environment%'

    app.abstract_base.controller:
        abstract: true
        arguments:
          - '@app.serializer.base'
          - '@app.cache'
          - '@doctrine'
          - '@app.user'
          - '@translator'
          - '@logger'
          - '@AppBundle\SqlView\SqlViewManager'

    AppBundle\Service\Google\FireBaseService:
        arguments:
          - '%firebase_notifications_project_id%'
          - '%firebase_notifications_client_id%'
          - '%firebase_notifications_client_email%'
          - '%firebase_notifications_private_key%'
          - '@logger'
          - '@translator'

    AppBundle\Service\ReportService:
        arguments:
          - '@enqueue.producer'
          - '@app.serializer.base'
          - '@doctrine.orm.entity_manager'
          - '@app.user'
          - '@translator'
          - '@logger'
          - '@AppBundle\Validation\UlnValidatorInterface'
          - '@app.report.pedigree_certificates'
          - '@app.report.livestock'
          - '@AppBundle\Service\Report\BirthListReportService'


    AppBundle\Processor\ReportProcessor:
        arguments:
          - '@AppBundle\Service\Report\AnnualActiveLivestockReportService'
          - '@AppBundle\Service\Report\AnnualTe100UbnProductionReportService'
          - '@AppBundle\Service\Report\FertilizerAccountingReport'
          - '@app.report.inbreeding_coefficient'
          - '@AppBundle\Service\Report\AnimalsOverviewReportService'
          - '@AppBundle\Service\Report\AnnualActiveLivestockRamMatesReportService'
          - '@AppBundle\Service\Report\OffspringReportService'
          - '@AppBundle\Service\Report\PedigreeRegisterOverviewReportService'
          - '@app.report.pedigree_certificates'
          - '@app.report.livestock'
          - '@AppBundle\Service\Report\BirthListReportService'
          - '@doctrine.orm.entity_manager'
          - '@logger'
          - '@app.serializer.base'
        tags:
          - {name: 'enqueue.client.processor'}

    AppBundle\Processor\SqsFeedbackProcessor:
        arguments:
          - '@AppBundle\Service\AwsFeedbackQueueService'
          - '@monolog.logger.feedback_worker'
          - '@logger'
          - '@AppBundle\Service\ProcessLocker'
          - '@AppBundle\Service\SettingsContainer'
          - '@translator'
          - '@AppBundle\Service\Worker\SyncAnimalRelocationProcessor'
          - '@AppBundle\Service\Worker\SyncHealthCheckProcessor'

    app.abstract_base.worker_task_processor:
        abstract: true
        arguments:
          - '@doctrine.orm.entity_manager'
          - '@AppBundle\Service\Worker\FeedbackJsonMessageReaderInterface'
          - '@logger'
        lazy: true

    AppBundle\Service\Worker\SyncAnimalRelocationProcessor:
        parent: app.abstract_base.worker_task_processor

    AppBundle\Service\Worker\SyncHealthCheckProcessor:
        parent: app.abstract_base.worker_task_processor
        calls:
          - method: setLocationHealthUpdater
            arguments:
              - '@app.health.locationhealth.updater'

    app.abstract_base.auth:
        parent: app.abstract_base.controller
        abstract: true
        calls:
          - method: setEmailService
            arguments:
              - '@app.email'
          - method: setEncoder
            arguments:
              - '@security.password_encoder'
          - method: setTemplatingService
            arguments:
              - '@templating'

    app.security.auth:
        parent: app.abstract_base.auth
        class: AppBundle\Service\AuthService

    app.security.admin_auth:
        parent: app.abstract_base.auth
        class: AppBundle\Service\AdminAuthService

    app.admin:
        parent: app.abstract_base.auth
        class: AppBundle\Service\AdminService

    app.admin.profile:
        parent: app.abstract_base.auth
        class: AppBundle\Service\AdminProfileService

    app.abstract_base.declare:
        parent: app.abstract_base.controller
        abstract: true
        calls:
          - method: setRequestMessageBuilder
            arguments:
              - '@app.request.message_builder'
          - method: setIrSerializer
            arguments:
              - '@app.serializer.ir'
          - method: setExternalQueueService
            arguments:
              - '@AppBundle\Service\AwsExternalQueueService'

    app.animal:
        parent: app.abstract_base.declare
        class: AppBundle\Service\AnimalService
        calls:
          - method: setAnimalDetailsOutput
            arguments:
              - '@AppBundle\Output\AnimalDetailsOutput'
          - method: setValidator
            arguments:
              - '@validator'
          - method: setInternalQueueService
            arguments:
              - '@AppBundle\Service\AwsInternalQueueService'

    AppBundle\Service\ArrivalService:
        parent: app.abstract_base.declare
        calls:
          - method: setArrivalProcessor
            arguments:
              - '@AppBundle\Worker\DirectProcessor\DeclareArrivalProcessorInterface'
          - method: setDepartProcessor
            arguments:
              - '@AppBundle\Worker\DirectProcessor\DeclareDepartProcessorInterface'
          - method: setImportProcessor
            arguments:
              - '@AppBundle\Worker\DirectProcessor\DeclareImportProcessorInterface'
          - method: setFireBaseService
            arguments:
              - '@AppBundle\Service\Google\FireBaseService'
          - method: setHealthUpdaterService
            arguments:
              - '@app.health.updater'
          - method: setAnimalLocationHistoryService
            arguments:
              - '@app.animallocation.history'
          - method: setEnvironment
            arguments:
              - '%kernel.environment%'

    AppBundle\Service\BirthService:
        parent: app.abstract_base.declare
        calls:
          - method: setEntityGetter
            arguments:
              - '@app.doctrine.entitygetter'
          - method: setLogger
            arguments:
              - '@logger'
          - method: setInternalQueueService
            arguments:
              - '@AppBundle\Service\AwsInternalQueueService'

    app.breed_type:
        parent: app.abstract_base.controller
        class: AppBundle\Service\BreedTypeService

    app.client:
        parent: app.abstract_base.controller
        class: AppBundle\Service\ClientService

    app.collar:
        parent: app.abstract_base.controller
        class: AppBundle\Service\CollarService

    app.company:
        parent: app.abstract_base.auth
        class: AppBundle\Service\CompanyService

    app.component:
        parent: app.abstract_base.controller
        class: AppBundle\Service\ComponentService

    app.contact:
        parent: app.abstract_base.auth
        class: AppBundle\Service\ContactService

    app.content_management:
        parent: app.abstract_base.controller
        class: AppBundle\Service\ContentManagementService

    app.country:
        parent: app.abstract_base.declare
        class: AppBundle\Service\CountryService

    app.dashboard:
        parent: app.abstract_base.controller
        class: AppBundle\Service\DashboardService


    AppBundle\Service\DepartService:
        parent: app.abstract_base.declare
        calls:
          - method: setArrivalProcessor
            arguments:
              - '@AppBundle\Worker\DirectProcessor\DeclareArrivalProcessorInterface'
          - method: setDepartProcessor
            arguments:
              - '@AppBundle\Worker\DirectProcessor\DeclareDepartProcessorInterface'
          - method: setExportProcessor
            arguments:
              - '@AppBundle\Worker\DirectProcessor\DeclareExportProcessorInterface'
          - method: setEnvironment
            arguments:
              - '%kernel.environment%'
          - method: setFireBaseService
            arguments:
              - '@AppBundle\Service\Google\FireBaseService'
          - method: setHealthUpdaterService
            arguments:
              - '@app.health.updater'

    AppBundle\Service\ExportService:
        parent: app.abstract_base.declare
        calls:
          - method: setExportProcessor
            arguments:
              - '@AppBundle\Worker\DirectProcessor\DeclareExportProcessorInterface'

    AppBundle\Service\ImportService:
        parent: app.abstract_base.declare
        calls:
          - method: setImportProcessor
            arguments:
              - '@AppBundle\Worker\DirectProcessor\DeclareImportProcessorInterface'

    app.invoice:
        parent: app.abstract_base.controller
        class: AppBundle\Service\InvoiceService
        calls:
          - method: instantiateServices
            arguments:
              - '@app.invoice.pdf.generator.service'
              - '@AppBundle\Service\ExternalProvider\ExternalProviderInvoiceService'
          - method: setFireBaseService
            arguments:
              - '@AppBundle\Service\Google\FireBaseService'

    app.invoice.rule:
        parent: app.abstract_base.controller
        class: AppBundle\Service\InvoiceRuleService

    app.invoice.rule.template:
        parent: app.abstract_base.controller
        class: AppBundle\Service\InvoiceRuleTemplateService

    app.invoice.sender.details:
        parent: app.abstract_base.controller
        class: AppBundle\Service\InvoiceSenderDetailsService

    app.invoice.pdf.generator.service:
        class: AppBundle\Service\Invoice\InvoicePdfGeneratorService
        arguments:
            - '@logger'
            - '@app.aws.storageservice'
            - '@app.user'
            - '@templating'
            - '@translator'
            - '@knp_snappy.pdf'
            - '%kernel.cache_dir%'
            - '%kernel.root_dir%'
            - '%output_reports_to_cache_folder_for_local_testing%'
            - '%display_report_pdf_output_as_html%'

    AppBundle\Service\Invoice\BatchInvoiceService:
        parent: app.abstract_base.controller
        calls:
          - method: initializeServices
            arguments:
              - '@AppBundle\Service\ExternalProvider\ExternalProviderInvoiceService'
          - method: setFireBaseService
            arguments:
              - '@AppBundle\Service\Google\FireBaseService'

    AppBundle\Service\LossService:
        parent: app.abstract_base.declare
        calls:
          - method: setLossProcessor
            arguments:
              - '@AppBundle\Worker\DirectProcessor\DeclareLossProcessorInterface'

    app.health.location:
        parent: app.abstract_base.controller
        class: AppBundle\Service\LocationHealthService

    app.mate:
        parent: app.abstract_base.controller
        class: AppBundle\Service\MateService

    app.measurement:
        parent: app.abstract_base.controller
        class: AppBundle\Service\MeasurementService

    app.messages:
        parent: app.abstract_base.controller
        class: AppBundle\Service\MessageService

    AppBundle\Service\MobileService:
        parent: app.abstract_base.controller

    app.mollie.payment:
        parent: app.abstract_base.controller
        class: AppBundle\Service\MolliePaymentService
        calls:
          - method: instantiateServices
            arguments:
              - '@app.mollie.service'
          - method: setKeys
            arguments:
              - '%mollie_test_api_key%'
              - '%mollie_prod_api_key%'
              - '%environment%'

    app.pedigree_register:
        parent: app.abstract_base.controller
        class: AppBundle\Service\PedigreeRegisterService

    AppBundle\Service\ProfileService:
        parent: app.abstract_base.controller

    AppBundle\Service\RevokeService:
        parent: app.abstract_base.declare
        calls:
          - method: setEntityGetter
            arguments:
              - '@app.doctrine.entitygetter'
          - method: setRevokeProcessor
            arguments:
              - '@AppBundle\Worker\DirectProcessor\RevokeProcessorInterface'

    AppBundle\Service\QueueDashboardService:
        parent: app.abstract_base.controller
        calls:
          - method: setExternalQueueService
            arguments:
              - '@AppBundle\Service\AwsExternalQueueService'
          - method: setInternalQueueService
            arguments:
              - '@AppBundle\Service\AwsInternalQueueService'

    AppBundle\Service\TagReplaceService:
        parent: app.abstract_base.declare
        calls:
          - method: setTagReplaceProcessor
            arguments:
              - '@AppBundle\Worker\DirectProcessor\DeclareTagReplaceProcessorInterface'

    AppBundle\Service\TagSyncService:
        parent: app.abstract_base.declare

    AppBundle\Service\TagTransferService:
        parent: app.abstract_base.declare
        calls:
          - method: setTagTransferProcessor
            arguments:
              - '@AppBundle\Worker\DirectProcessor\DeclareTagTransferProcessorInterface'

    AppBundle\Service\TagsService:
        parent: app.abstract_base.controller

    AppBundle\Service\UbnService:
        parent: app.abstract_base.declare

    AppBundle\Service\VwaEmployeeService:
        parent: app.abstract_base.auth

    AppBundle\Service\WeightService:
        parent: app.abstract_base.controller

    AppBundle\Service\PedigreeDataGenerator:
        arguments:
          - '@doctrine.orm.entity_manager'
          - '@logger'

    app.pedigree_data_reprocessor.base:
        abstract: true
        arguments:
          - '@doctrine.orm.default_entity_manager'
          - '@logger'
          - '@AppBundle\Service\PedigreeDataGenerator'

    AppBundle\Service\Migration\PedigreeDataReprocessor:
        parent: app.pedigree_data_reprocessor.base

    AppBundle\Service\Migration\ScrapieGenotypeReprocessor:
        parent: app.pedigree_data_reprocessor.base


    app.abstract_base.external_provider:
        abstract: true
        arguments:
            - '@AppBundle\Service\ExternalProvider\ExternalProviderAuthenticator'
        calls:
            - method: reAuthenticate

    AppBundle\Service\ExternalProvider\ExternalProviderAuthenticator:
        arguments:
            - '%external_provider_user%'
            - '%external_provider_password%'
            - '%external_provider_organisation%'

    AppBundle\Service\ExternalProvider\ExternalProviderInvoiceService:
        parent: app.abstract_base.external_provider
        calls:
            - method: setExternalProviderCustomerService
              arguments:
                - '@AppBundle\Service\ExternalProvider\ExternalProviderCustomerService'

    AppBundle\Service\ExternalProvider\ExternalProviderCustomerService:
        parent: app.abstract_base.external_provider
        calls:
            - method: setExternalProviderOfficeService
              arguments:
                - '@AppBundle\Service\ExternalProvider\ExternalProviderOfficeService'

    AppBundle\Service\ExternalProvider\ExternalProviderOfficeService:
        parent: app.abstract_base.external_provider

    AppBundle\SqlView\SqlViewManager:
        arguments:
          - '@AppBundle\SqlView\Repository\ViewAnimalLivestockOverviewDetailsRepository'
          - '@AppBundle\SqlView\Repository\ViewLitterDetailsRepository'
          - '@AppBundle\SqlView\Repository\ViewLocationDetailsRepository'
          - '@AppBundle\SqlView\Repository\ViewMinimalParentDetailsRepository'
          - '@AppBundle\SqlView\Repository\ViewPedigreeRegisterAbbreviationRepository'
          - '@AppBundle\SqlView\Repository\ViewPersonFullNameRepository'

    app.sqlview.repository.base:
        abstract: true
        arguments:
          - '@app.serializer.base'
          - '@doctrine.orm.default_entity_manager'
        calls:
          - method: init
        lazy: true

    AppBundle\SqlView\Repository\ViewAnimalLivestockOverviewDetailsRepository:
        parent: app.sqlview.repository.base

    AppBundle\SqlView\Repository\ViewLitterDetailsRepository:
        parent: app.sqlview.repository.base

    AppBundle\SqlView\Repository\ViewLocationDetailsRepository:
        parent: app.sqlview.repository.base

    AppBundle\SqlView\Repository\ViewMinimalParentDetailsRepository:
        parent: app.sqlview.repository.base

    AppBundle\SqlView\Repository\ViewPedigreeRegisterAbbreviationRepository:
        parent: app.sqlview.repository.base

    AppBundle\SqlView\Repository\ViewPersonFullNameRepository:
        parent: app.sqlview.repository.base


    app.output.base:
        abstract: true
        arguments:
          - '@app.serializer.base'
          - '@doctrine.orm.default_entity_manager'
          - '@AppBundle\SqlView\SqlViewManager'
          - '@translator'

    AppBundle\Output\AnimalDetailsOutput:
        parent: app.output.base
        calls:
          - method: setBreedValuesOutput
            arguments:
              - '@AppBundle\Output\BreedValuesOutput'

    AppBundle\Output\BreedValuesOutput:
        parent: app.output.base

    AppBundle\Service\AnimalResidenceServiceInterface:
        parent: app.abstract_base.controller
        class: AppBundle\Service\AnimalResidenceService

    AppBundle\Validation\UlnValidatorInterface: '@AppBundle\Validation\UlnValidator'

    AppBundle\Validation\UlnValidator:
        arguments:
          - '@doctrine.orm.entity_manager'
          - '@AppBundle\SqlView\Repository\ViewMinimalParentDetailsRepository'
          - '@translator'
        lazy: true


    app.abstract_base.direct_processor:
        abstract: true
        parent: app.abstract_base.controller
        calls:
          - method: setEnvironment
            arguments:
              - '%kernel.environment%'
          - method: setInternalQueueService
            arguments:
              - '@AppBundle\Service\AwsInternalQueueService'

    AppBundle\Worker\DirectProcessor\DeclareArrivalProcessorInterface:
        class: AppBundle\Worker\DirectProcessor\DeclareArrivalProcessor
        parent: app.abstract_base.direct_processor

    AppBundle\Worker\DirectProcessor\DeclareDepartProcessorInterface:
        class: AppBundle\Worker\DirectProcessor\DeclareDepartProcessor
        parent: app.abstract_base.direct_processor

    AppBundle\Worker\DirectProcessor\DeclareExportProcessorInterface:
        class: AppBundle\Worker\DirectProcessor\DeclareExportProcessor
        parent: app.abstract_base.direct_processor

    AppBundle\Worker\DirectProcessor\DeclareImportProcessorInterface:
        class: AppBundle\Worker\DirectProcessor\DeclareImportProcessor
        parent: app.abstract_base.direct_processor

    AppBundle\Worker\DirectProcessor\DeclareLossProcessorInterface:
        class: AppBundle\Worker\DirectProcessor\DeclareLossProcessor
        parent: app.abstract_base.direct_processor

    AppBundle\Worker\DirectProcessor\DeclareTagReplaceProcessorInterface:
        class: AppBundle\Worker\DirectProcessor\DeclareTagReplaceProcessor
        parent: app.abstract_base.direct_processor

    AppBundle\Worker\DirectProcessor\DeclareTagTransferProcessorInterface:
        class: AppBundle\Worker\DirectProcessor\DeclareTagTransferProcessor
        parent: app.abstract_base.direct_processor

    AppBundle\Service\Worker\FeedbackJsonMessageReaderInterface:
        class: AppBundle\Service\Worker\JavaJsonReader
        parent: AppBundle\Service\Worker\JavaJsonReader

    AppBundle\Service\Worker\JavaJsonReader:
        arguments:
          - '@doctrine.orm.entity_manager'
          - '@app.serializer.base'

    AppBundle\Worker\DirectProcessor\RevokeProcessorInterface:
        class: AppBundle\Worker\DirectProcessor\RevokeProcessor
        parent: app.abstract_base.direct_processor

    AppBundle\Service\ProcessLocker:
        arguments:
          - '@monolog.logger.feedback_worker'
          - '@AppBundle\Service\SettingsContainer'

    AppBundle\Service\SettingsContainer:
        arguments:
          - '%max_feedback_workers%'

    # Listeners
    AppBundle\EventListener\ViewListener:
        tags:
            - { name: kernel.event_listener, event: kernel.view }

    AppBundle\EventListener\ExceptionListener:
        arguments:
            - '@logger'
            - '@monolog.logger.non_security'
            - '@monolog.logger.security'
            - '%environment%'
        tags:
            - { name: kernel.event_listener, event: kernel.exception }

    # This custom handler is not properly registered by the jms serializer yet!
    jms_serializer.custom_datetime_handler:
        class: AppBundle\Serializer\CustomDateTimeHandler
        tags:
          - { name: jms_serializer.subscribing_handler, method: deserializeDateTimeToJson, type: DateTime, format: json, direction: deserialization }