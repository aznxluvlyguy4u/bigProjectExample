# Learn more about services, parameters and containers at
# http://symfony.com/doc/current/book/service_container.html
parameters:
#    parameter_name: value

services:
    api.entity.validate:
        class: AppBundle\Service\ValidateEntityService
        arguments: ['@validator', '@jms_serializer']

    api.action_log:
        class: AppBundle\Service\ActionLogService
        arguments:
          - '@doctrine.orm.entity_manager'
          - '@app.serializer.ir'
          - '@app.user'
          - '@app.cache'

    app.cli.gender_changer:
        class: AppBundle\Service\DataFix\GenderChangeCommandService
        arguments:
          - '@doctrine.orm.entity_manager'

    app.cli.internal_worker.depart:
        class: AppBundle\Service\Worker\DepartInternalWorkerCliOptions
        arguments:
          - '@doctrine.orm.entity_manager'

    app.cli.mixblup:
        class: AppBundle\Service\MixBlupCliOptionsService
        arguments:
          - '@doctrine.orm.entity_manager'
          - '@logger'
          - '@app.report.breed_values_overview'
          - '@app.breed.valueprinter'
          - '@app.breed.value'
          - '@app.breed.index'
          - '@app.excel.service'
          - '@AppBundle\Service\Migration\LambMeatIndexMigrator'
          - '@AppBundle\Service\Migration\WormResistanceIndexMigrator'
          - '@app.mixblup.input'
          - '@app.mixblup.input.validate'
          - '@app.mixblup.output'
          - '@AppBundle\Service\Migration\MixBlupAnalysisTypeMigrator'
          - '@app.report.pedigree_register'

    app.info.parameters:
        class: AppBundle\Service\InfoService
        arguments:
          - '@doctrine.orm.entity_manager'
          - '@logger'
          - '@app.aws.storageservice'
          - '%kernel.environment%'
          - '%environment%'
          - '%kernel.root_dir%'
          - '%kernel.cache_dir%'
          - '%redis_host%'
          - '@app.aws.queueservice.external'
          - '@app.aws.queueservice.internal'
          - '@app.aws.queueservice.mixblup_input'
          - '@app.aws.queueservice.mixblup_output'


    app.request.message_builder:
        class: AppBundle\Component\RequestMessageBuilder
        arguments:
          - '@doctrine.orm.entity_manager'
          - '@app.serializer.ir'
          - '%kernel.environment%'


    app.aws.queueservice.workers_base:
        abstract: true
        arguments:
        #NOTE! Don't use named keys here! That will prevent the child services from properly overriding the arguments.
          - placeholder_to_override #queueIdPrefix
          - '%aws_access_key_id%'
          - '%aws_secret_key%'
          - '%aws_sqs_region%' #region
          - '%aws_sqs_version%' #version
          - '%environment%' #currentEnv
          - '%kernel.environment%'
          - true

    app.aws.queueservice.external:
        class: AppBundle\Service\AwsExternalQueueService
        parent: app.aws.queueservice.workers_base
        arguments: { index_0: '%aws_sqs_queue_exteral_prefix%' }

    app.aws.queueservice.external.test:
        class: AppBundle\Service\AwsExternalTestQueueService
        parent: app.aws.queueservice.workers_base
        arguments: { index_0: '%aws_sqs_queue_exteral_prefix%', index_5: !php/const:AppBundle\Constant\Environment::TEST, index_7: false }

    app.aws.queueservice.internal:
        class: AppBundle\Service\AwsInternalQueueService
        parent: app.aws.queueservice.workers_base
        arguments: { index_0: '%aws_sqs_queue_interal_prefix%' }

    app.aws.queueservice.internal.test:
        class: AppBundle\Service\AwsInternalTestQueueService
        parent: app.aws.queueservice.workers_base
        arguments: { index_0: '%aws_sqs_queue_interal_prefix%', index_5: !php/const:AppBundle\Constant\Environment::TEST, index_7: false }

    app.aws.queueservice.mixblup_input:
        class: AppBundle\Service\MixBlupInputQueueService
        parent: app.aws.queueservice.workers_base
        arguments: { index_0: '%aws_sqs_queue_mixblup_input_prefix%', index_7: false }

    app.aws.queueservice.mixblup_output:
        class: AppBundle\Service\MixBlupOutputQueueService
        parent: app.aws.queueservice.workers_base
        arguments: { index_0: '%aws_sqs_queue_mixblup_output_prefix%', index_7: false }

    app.aws.storageservice:
        class: AppBundle\Service\AWSSimpleStorageService
        arguments:
          - '%aws_access_key_id%'
          - '%aws_secret_key%'
          - '%aws_s3_region%'
          - '%aws_s3_version%'
          - '%aws_s3_bucket%'
          - '%environment%'
          - '%kernel.environment%'

    app.mollie.service:
        class: AppBundle\Service\MollieService
        arguments:
          $credentials: ['%mollie_test_api_key%', '%mollie_prod_api_key%']
          $apiUrls: ['%api_local_host_url%','%api_stage_host_url%','%api_prod_host_url%']
          $webUrls: ['%web_local_host_url%','%web_stage_host_url%','%web_prod_host_url%']
          $currentEnvironment: '%environment%'

    app.doctrine.entitygetter:
        class: AppBundle\Service\EntityGetter
        arguments: ['@doctrine.orm.entity_manager']

    app.modifier.message:
        class: AppBundle\Component\Modifier\MessageModifier
        arguments: ['@doctrine.orm.entity_manager']

    app.modifier.animalremover:
        class: AppBundle\Component\Modifier\AnimalRemover
        arguments: ['@doctrine.orm.entity_manager']

    app.animal.details.updater:
        parent: app.abstract_base.controller
        class: AppBundle\Service\AnimalDetailsUpdaterService
        calls:
          - method: setAnimalDetailsBatchUpdater
            arguments:
              - '@AppBundle\Service\AnimalDetailsBatchUpdaterService'

    AppBundle\Service\AnimalDetailsBatchUpdaterService:
        parent: app.abstract_base.controller

    app.animallocation.history:
        class: AppBundle\Service\AnimalLocationHistoryService
        arguments: ['@doctrine.orm.entity_manager']

    app.messagebuilder.base:
        class: AppBundle\Component\MessageBuilderBase
        arguments:
          - '@doctrine.orm.entity_manager'
          - '%environment%'

    app.mixblup.input:
        class: AppBundle\Service\MixBlupInputFilesService
        arguments:
          - '@doctrine.orm.entity_manager'
          - '@app.aws.storageservice'
          - '@app.aws.queueservice.mixblup_input'
          - '%environment%'
          - '%kernel.cache_dir%'
          - '@logger'

    app.mixblup.output:
        class: AppBundle\Service\MixBlupOutputFilesService
        arguments:
          - '@doctrine.orm.entity_manager'
          - '@app.aws.storageservice'
          - '@app.aws.queueservice.mixblup_output'
          - '@app.breed.index'
          - '@app.breed.value'
          - '@AppBundle\Service\NormalDistributionService'
          - '%environment%'
          - '%kernel.cache_dir%'
          - '@logger'

    app.mixblup.input.validate:
        class: AppBundle\Component\MixBlup\MixBlupInputFileValidator
        arguments: ['%kernel.cache_dir%']


    AppBundle\Service\NormalDistributionService:
        arguments:
          - '@doctrine.orm.entity_manager'
          - '@logger'
        calls:
          - method: onInit

    app.datafix.base.duplicate:
        abstract: true
        arguments:
        #NOTE! Don't use named keys here! That will prevent the child services from properly overriding the arguments.
          - '@doctrine.orm.entity_manager'

    app.datafix.animals.duplicate:
        parent: app.datafix.base.duplicate
        class: AppBundle\Service\DataFix\DuplicateAnimalsFixer

    app.datafix.litter.duplicate:
        parent: app.datafix.base.duplicate
        class: AppBundle\Service\DataFix\DuplicateLitterFixer

    app.datafix.animals.exterminator:
        parent: app.datafix.base.duplicate
        class: AppBundle\Service\DataFix\AnimalExterminator

    app.datafix.ubn:
        parent: app.datafix.base.duplicate
        class: AppBundle\Service\DataFix\UbnFixer

    app.datafix.base:
        abstract: true
        arguments:
        #NOTE! Don't use named keys here! That will prevent the child services from properly overriding the arguments.
          - '@doctrine.orm.entity_manager'
          - '@logger'
          - '%kernel.root_dir%'

    app.datafix.breed_code.offspring.recalculation:
        parent: app.datafix.base
        class: AppBundle\Service\DataFix\OffspringBreedCodeRecalculator

    app.datafix.birth.measurements.missing:
        parent: app.datafix.base
        class: AppBundle\Service\DataFix\MissingBirthMeasurementsService


    app.migrator.vsm:
        class: AppBundle\Service\Migration\VsmMigratorService
        arguments:
          - '@doctrine.orm.entity_manager'
          - '%kernel.root_dir%'
          - '@app.migrator.importer.animaltable'
          - '@app.migrator.animaltable'
          - '@app.migrator.birth'
          - '@app.migrator.date_of_death'
          - '@app.migrator.exteriors'
          - '@app.migrator.litters'
          - '@app.migrator.tagreplace'
          - '@app.migrator.wormresistance'
          - '@app.datafix.animals.duplicate'
          - '@app.datafix.litter.duplicate'

    app.migrator.base:
        abstract: true
        arguments:
        #NOTE! Don't use named keys here! That will prevent the child services from properly overriding the arguments.
          - '@doctrine.orm.entity_manager'
          - '%kernel.root_dir%'

    app.migrator.importer.animaltable:
        class: AppBundle\Service\Migration\AnimalTableImporter
        arguments:
          - '@doctrine.orm.entity_manager'
          - '%kernel.root_dir%'
          - '@app.datafix.animals.duplicate'
          - '@app.datafix.ubn'

    app.migrator.animaltable:
        class: AppBundle\Service\Migration\AnimalTableMigrator
        arguments:
          - '@doctrine.orm.entity_manager'
          - '%kernel.root_dir%'
          - '@app.datafix.ubn'

    app.migrator.birth:
        parent: app.migrator.base
        class: AppBundle\Service\Migration\BirthDataMigrator

    app.initializer.birth_progress:
        parent: app.migrator.base
        class: AppBundle\Service\Migration\BirthProgressInitializer

    AppBundle\Service\Migration\PedigreeRegisterRegistrationMigrator:
        parent: app.migrator.base

    app.initializer.treatment_type:
        parent: app.migrator.base
        class: AppBundle\Service\Migration\TreatmentTypeInitializer

    app.initializer.stored_procedure:
        class: AppBundle\Service\Migration\StoredProcedureInitializer
        arguments:
          - '@doctrine.orm.entity_manager'
          - '@logger'
          - '@translator'

    app.migrator.client:
        class: AppBundle\Service\Migration\ClientMigrator
        arguments:
          - '@doctrine.orm.entity_manager'
          - '%kernel.root_dir%'
          - '@security.password_encoder'

    app.migrator.date_of_death:
        parent: app.migrator.base
        class: AppBundle\Service\Migration\DateOfDeathMigrator

    app.migrator.exteriors:
        parent: app.migrator.base
        class: AppBundle\Service\Migration\ExteriorMigrator

    AppBundle\Service\Migration\ScanMeasurementsMigrator:
        parent: app.migrator.base

    app.migrator.inspector:
        parent: app.migrator.base
        class: AppBundle\Service\Migration\InspectorMigrator

    app.migrator.breed_index_base:
        abstract: true
        arguments:
        #NOTE! Don't use named keys here! That will prevent the child services from properly overriding the arguments.
          - '@doctrine.orm.entity_manager'
          - '@logger'

    AppBundle\Service\Migration\LedgerCategoryMigrator:
        parent: app.migrator.base

    AppBundle\Service\Migration\MixBlupAnalysisTypeMigrator:
        parent: app.migrator.base

    AppBundle\Service\Migration\LambMeatIndexMigrator:
        parent: app.migrator.breed_index_base

    AppBundle\Service\Migration\WormResistanceIndexMigrator:
        parent: app.migrator.breed_index_base

    app.migrator.litters:
        parent: app.migrator.base
        class: AppBundle\Service\Migration\LitterMigrator

    app.migrator.tagreplace:
        parent: app.migrator.base
        class: AppBundle\Service\Migration\TagReplaceMigrator

    app.migrator.wormresistance:
        parent: app.migrator.base
        class: AppBundle\Service\Migration\WormResistanceMigrator

    app.breed.index:
        class: AppBundle\Service\BreedIndexService
        arguments:
          - '@doctrine.orm.entity_manager'
          - '@logger'

    app.breed.value:
        class: AppBundle\Service\BreedValueService
        arguments:
          - '@doctrine.orm.entity_manager'
          - '@logger'

    app.breed.valueprinter:
        class: AppBundle\Service\BreedValuePrinter
        arguments:
          - '@doctrine.orm.entity_manager'
          - '@logger'
          - '%kernel.cache_dir%'

    app.excel.service:
        class: AppBundle\Service\ExcelService
        arguments:
          - '@phpexcel'
          - '%kernel.cache_dir%'
          - '@logger'

    app.serializer.base:
        class: AppBundle\Service\BaseSerializer
        arguments: ['@jms_serializer']

    app.serializer.ir:
        class: AppBundle\Service\IRSerializer
        arguments: ['@jms_serializer', '@doctrine.orm.entity_manager', '@app.doctrine.entitygetter']

    app.health.updater:
        class: AppBundle\Service\HealthUpdaterService
        arguments:
          - '@doctrine.orm.entity_manager'
          - '@app.health.locationhealth.updater'

    app.health.locationhealth.updater:
        class: AppBundle\Util\LocationHealthUpdater
        arguments:
          - '@doctrine.orm.entity_manager'
          - '@app.email'

    app.authenticator.token:
        class: AppBundle\Component\Authentication\TokenAuthenticator
        arguments:
          - '@doctrine.orm.entity_manager'
          - '@security.http_utils'
          - ['/api/v1/doc', '/api/v1/auth/register', '/api/v1/auth/authorize']
        public: false

    app.cache:
        class: AppBundle\Service\CacheService
        arguments:
          - '%redis_host%'

    app.user:
        class: AppBundle\Service\UserService
        arguments:
          - '@doctrine.orm.entity_manager'
          - '@security.token_storage'

    app.pdf.invoice_pdf_generator_service:
        class: AppBundle\Service\Invoice\InvoicePdfGeneratorService
        arguments:
          - '@doctrine.orm.entity_manager'

    app.report.generator.query.breed_values:
        class: AppBundle\Service\Report\BreedValuesReportQueryGenerator
        arguments:
          - '@doctrine.orm.entity_manager'

    app.report.base:
        abstract: true
        arguments:
        #NOTE! Don't use named keys here! That will prevent the child services from properly overriding the arguments.
          - '@doctrine.orm.entity_manager'
          - '@app.excel.service'
          - '@logger'
          - '@app.aws.storageservice'
          - '@app.writer.csv_from_sql_results'
          - '@app.user'
          - '@templating'
          - '@translator'
          - '@knp_snappy.pdf'
          - '%kernel.cache_dir%'
          - '%kernel.root_dir%'
          - '%output_reports_to_cache_folder_for_local_testing%'
          - '%display_report_pdf_output_as_html%'

    app.report.breedvalues.base:
        abstract: true
        arguments:
        #NOTE! Don't use named keys here! That will prevent the child services from properly overriding the arguments.
          - '@doctrine.orm.entity_manager'
          - '@app.excel.service'
          - '@logger'
          - '@app.aws.storageservice'
          - '@app.writer.csv_from_sql_results'
          - '@app.user'
          - '@templating'
          - '@translator'
          - '@knp_snappy.pdf'
          - '@app.report.generator.query.breed_values'
          - '%kernel.cache_dir%'
          - '%kernel.root_dir%'
          - '%output_reports_to_cache_folder_for_local_testing%'
          - '%display_report_pdf_output_as_html%'

    app.report.livestock:
        parent: app.report.breedvalues.base
        class: AppBundle\Service\Report\LiveStockReportService

    app.report.pedigree_certificates:
        parent: app.report.base
        class: AppBundle\Service\Report\PedigreeCertificateReportService

    app.report.pedigree_register:
        parent: app.report.base
        class: AppBundle\Service\Report\PedigreeRegisterOverviewReportService

    app.report.breed_values_overview:
        parent: app.report.breedvalues.base
        class: AppBundle\Service\Report\BreedValuesOverviewReportService

    app.report.inbreeding_coefficient:
        parent: app.report.base
        class: AppBundle\Service\Report\InbreedingCoefficientReportService

    app.report.vwa.animal_details:
        parent: app.report.base
        class: AppBundle\Service\Report\VwaAnimalDetailsReportService

    app.report.vwa.ubns_overview:
        parent: app.report.base
        class: AppBundle\Service\Report\VwaUbnsOverviewReportService

    app.writer.csv_from_sql_results:
        class: AppBundle\Service\CsvFromSqlResultsWriterService
        arguments:
            - '@doctrine.orm.entity_manager'
            - '%kernel.cache_dir%'


    app.declare.error_message:
        parent: app.abstract_base.controller
        class: AppBundle\Service\ErrorMessageService

    AppBundle\Service\LedgerCategoryService:
        parent: app.abstract_base.controller

    app.treatment.base:
        parent: app.abstract_base.controller
        abstract: true
        calls:
          - method: onInit

    app.treatment:
        parent: app.treatment.base
        class: AppBundle\Service\TreatmentService

    app.treatment.template:
        parent: app.treatment.base
        class: AppBundle\Service\TreatmentTemplateService

    app.treatment.type:
        parent: app.treatment.base
        class: AppBundle\Service\TreatmentTypeService

    app.email:
        class: AppBundle\Service\EmailService
        arguments:
          - '@mailer'
          - '%mailer_source_address%'
          - '%notification_email_addresses%'
          - '@templating'
          - '@translator'
          - '%kernel.environment%'

    app.abstract_base.controller:
        abstract: true
        arguments:
          - '@app.serializer.base'
          - '@app.cache'
          - '@doctrine.orm.entity_manager'
          - '@app.user'
          - '@translator'
          - '@logger'

    app.abstract_base.auth:
        parent: app.abstract_base.controller
        abstract: true
        calls:
          - method: setEmailService
            arguments:
              - '@app.email'
          - method: setEncoder
            arguments:
              - '@security.password_encoder'
          - method: setTemplatingService
            arguments:
              - '@templating'

    app.security.auth:
        parent: app.abstract_base.auth
        class: AppBundle\Service\AuthService

    app.security.admin_auth:
        parent: app.abstract_base.auth
        class: AppBundle\Service\AdminAuthService

    app.admin:
        parent: app.abstract_base.auth
        class: AppBundle\Service\AdminService

    app.admin.profile:
        parent: app.abstract_base.auth
        class: AppBundle\Service\AdminProfileService

    app.abstract_base.declare:
        parent: app.abstract_base.controller
        abstract: true
        calls:
          - method: setRequestMessageBuilder
            arguments:
              - '@app.request.message_builder'
          - method: setIrSerializer
            arguments:
              - '@app.serializer.ir'
          - method: setExternalQueueService
            arguments:
              - '@app.aws.queueservice.external'

    app.animal:
        parent: app.abstract_base.declare
        class: AppBundle\Service\AnimalService

    app.arrival:
        parent: app.abstract_base.declare
        class: AppBundle\Service\ArrivalService
        calls:
          - method: setHealthUpdaterService
            arguments:
              - '@app.health.updater'
          - method: setAnimalLocationHistoryService
            arguments:
              - '@app.animallocation.history'
          - method: setEnvironment
            arguments:
              - '%kernel.environment%'

    app.birth:
        parent: app.abstract_base.declare
        class: AppBundle\Service\BirthService
        calls:
          - method: setEntityGetter
            arguments:
              - '@app.doctrine.entitygetter'
          - method: setLogger
            arguments:
              - '@logger'
          - method: setInternalQueueService
            arguments:
              - '@app.aws.queueservice.internal'

    app.breed_type:
        parent: app.abstract_base.controller
        class: AppBundle\Service\BreedTypeService

    app.client:
        parent: app.abstract_base.controller
        class: AppBundle\Service\ClientService

    app.collar:
        parent: app.abstract_base.controller
        class: AppBundle\Service\CollarService

    app.company:
        parent: app.abstract_base.auth
        class: AppBundle\Service\CompanyService

    app.component:
        parent: app.abstract_base.controller
        class: AppBundle\Service\ComponentService

    app.contact:
        parent: app.abstract_base.auth
        class: AppBundle\Service\ContactService

    app.content_management:
        parent: app.abstract_base.controller
        class: AppBundle\Service\ContentManagementService

    app.country:
        parent: app.abstract_base.declare
        class: AppBundle\Service\CountryService

    app.dashboard:
        parent: app.abstract_base.controller
        class: AppBundle\Service\DashboardService


    app.depart:
        parent: app.abstract_base.declare
        class: AppBundle\Service\DepartService
        calls:
          - method: setEnvironment
            arguments:
              - '%kernel.environment%'
    app.export:
        parent: app.abstract_base.declare
        class: AppBundle\Service\ExportService

    app.import:
        parent: app.abstract_base.declare
        class: AppBundle\Service\ImportService

    app.invoice:
        parent: app.abstract_base.controller
        class: AppBundle\Service\InvoiceService

    app.invoice.rule:
        parent: app.abstract_base.controller
        class: AppBundle\Service\InvoiceRuleService

    app.invoice.rule.template:
        parent: app.abstract_base.controller
        class: AppBundle\Service\InvoiceRuleTemplateService

    app.invoice.sender.details:
        parent: app.abstract_base.controller
        class: AppBundle\Service\InvoiceSenderDetailsService

    app.loss:
        parent: app.abstract_base.declare
        class: AppBundle\Service\LossService

    app.health.location:
        parent: app.abstract_base.controller
        class: AppBundle\Service\LocationHealthService

    app.mate:
        parent: app.abstract_base.controller
        class: AppBundle\Service\MateService

    app.measurement:
        parent: app.abstract_base.controller
        class: AppBundle\Service\MeasurementService

    app.messages:
        parent: app.abstract_base.controller
        class: AppBundle\Service\MessageService

    app.mollie.payment:
        class: AppBundle\Service\MolliePaymentService
        arguments:
          - '@app.serializer.base'
          - '@app.cache'
          - '@doctrine.orm.entity_manager'
          - '@app.user'
          - '@app.mollie.service'
          - '%mollie_test_api_key%'
          - '%mollie_prod_api_key%'
          - '%environment%'

    app.pedigree_register:
        parent: app.abstract_base.controller
        class: AppBundle\Service\PedigreeRegisterService

    app.profile:
        parent: app.abstract_base.controller
        class: AppBundle\Service\ProfileService

    app.declare.revoke:
        parent: app.abstract_base.declare
        class: AppBundle\Service\RevokeService
        calls:
          - method: setEntityGetter
            arguments:
              - '@app.doctrine.entitygetter'

    app.queue_dashboard:
        parent: app.abstract_base.controller
        class: AppBundle\Service\QueueDashboardService
        calls:
          - method: setExternalQueueService
            arguments:
              - '@app.aws.queueservice.external'
          - method: setInternalQueueService
            arguments:
              - '@app.aws.queueservice.internal'

    app.tag.replace:
        parent: app.abstract_base.declare
        class: AppBundle\Service\TagReplaceService

    app.tag.sync:
        parent: app.abstract_base.declare
        class: AppBundle\Service\TagSyncService

    app.tag.transfer:
        parent: app.abstract_base.declare
        class: AppBundle\Service\TagTransferService

    app.tags:
        parent: app.abstract_base.controller
        class: AppBundle\Service\TagsService

    app.ubn:
        parent: app.abstract_base.declare
        class: AppBundle\Service\UbnService

    app.vwa.employee:
        parent: app.abstract_base.auth
        class: AppBundle\Service\VwaEmployeeService

    app.weight:
        parent: app.abstract_base.controller
        class: AppBundle\Service\WeightService

    # This custom handler is not properly registered by the jms serializer yet!
    jms_serializer.custom_datetime_handler:
        class: AppBundle\Serializer\CustomDateTimeHandler
        tags:
          - { name: jms_serializer.subscribing_handler, method: deserializeDateTimeToJson, type: DateTime, format: json, direction: deserialization }
